<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>Happy Birthday</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
    <link rel="stylesheet" type="text/css" href="loading.css">
    <link rel="stylesheet/less" href="cake.less">
    <script src="less.min.js"></script>
    <style>
        /* åˆå§‹æŒ‰é’®éšè— */
        #play, #bannar_coming, #balloons_flying, #cake_fadein, #light_candle, #make_wish, #blow_candle, #wish_message, #story {
            display: none;
        }

        /* æ°”çƒå®¹å™¨ï¼šé”å®šåœ¨åº•éƒ¨ï¼Œé¿å¼€è›‹ç³• */
        .balloons { 
            position: absolute; 
            display: none; 
            z-index: 500; 
            width: 100px;
            top: 85%; 
        }
        
        /* å…³é”®ï¼šå¼ºåˆ¶è¿˜åŸåŸç‰ˆæ–‡å­—æ ·å¼ */
        .balloons h2 {
            position: absolute;
            top: 40% !important; 
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            margin: 0 !important;
            padding: 0 !important;
            z-index: 999 !important; 
            font-family: 'Signika', sans-serif;
            font-size: 30px;
            font-weight: bold;
            pointer-events: none;
            text-align: center;
            width: 100%;
            /* --- ä¿®æ”¹ï¼šåˆå§‹çŠ¶æ€å®Œå…¨é€æ˜å¹¶éšè— --- */
            opacity: 0;
            visibility: hidden;
            transition: opacity 2s ease; /* è®©æ–‡å­—æ˜¾ç°æ—¶æœ‰ 2 ç§’çš„æ·¡å…¥æ•ˆæœ */
        }

        /* å¿ƒé‡Œè¯é¿è®©ï¼šå›ºå®šåœ¨æœ€åº•éƒ¨ */
        .message {
            position: fixed; 
            bottom: 16vh; 
            width: 100%; 
            z-index: 1000;
            text-align: center;
            display: none;
        }
        .message p { font-size: 22px; font-weight: bold; color: #333; }

        #fireworks-canvas {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 9999; background: #000; display: none;
        }
    </style>
</head>

<body>
    <div class="loading"></div>
    <div id="wish_guide" style="display:none; position:fixed; top:26%; width:100%; text-align:center; z-index:2000; color:#ff0000; font-size:26px;font-weight: bold;">é—­ä¸Šçœ¼ç›ï¼Œè®¸ä¸ªæ„¿å§...</div>
    
    <audio id="main_audio" loop preload="auto"><source src="hbd.mp3"></audio>
    <audio id="firework_audio" loop preload="auto"><source src="song.mp3"></audio>

    <div class="balloons" id="b1"><img src="images/b1.png"><h2 style="color: #F2B300;">ğŸˆ</h2></div>
    <div class="balloons" id="b2"><img src="images/b2.png"><h2 style="color: #0719D4;">ç”Ÿ</h2></div>
    <div class="balloons" id="b3"><img src="images/b3.png"><h2 style="color: #D14D39;">æ—¥</h2></div>
    <div class="balloons" id="b4"><img src="images/b4.png"><h2 style="color: #8FAD00;">å¿«</h2></div>
    <div class="balloons" id="b5"><img src="images/b5.png"><h2 style="color: #8377E4;">ä¹</h2></div>
    <div class="balloons" id="b6"><img src="images/b6.png"><h2 style="color: #99C96A;">â¤</h2></div>
    <div class="balloons" id="b7"><img src="images/b7.png"><h2 style="color: #20CFB4;">ğŸˆ</h2></div>

    <img src="images/Balloon-Border.png" width="100%" class="balloon-border">

    <div class="container">
        <div class="row">
            <div class="col-md-2 col-xs-2 bulb-holder"><div class="bulb" id="bulb_yellow"></div></div>
            <div class="col-md-2 col-xs-2 bulb-holder"><div class="bulb" id="bulb_red"></div></div>
            <div class="col-md-2 col-xs-2 bulb-holder"><div class="bulb" id="bulb_blue"></div></div>
            <div class="col-md-2 col-xs-2 bulb-holder"><div class="bulb" id="bulb_green"></div></div>
            <div class="col-md-2 col-xs-2 bulb-holder"><div class="bulb" id="bulb_pink"></div></div>
            <div class="col-md-2 col-xs-2 bulb-holder"><div class="bulb" id="bulb_orange"></div></div>
        </div>
        <div class="row"><div class="col-md-12 text-center"><img src="images/banner.png" class="bannar"></div></div>
        
        <div class="row cake-cover">
            <div class="col-md-12 text-center">
                <div class="cake">
                  <div class="velas">
                    <div class="fuego"></div><div class="fuego"></div><div class="fuego"></div><div class="fuego"></div><div class="fuego"></div>
                  </div>
                  <div class="cobertura"></div><div class="bizcocho"></div>
                </div>
            </div>
        </div>

        <div class="row message"><div class="col-md-12"><p></p></div></div>

        <div class="navbar navbar-fixed-bottom">
            <div class="row">
                <div class="col-md-6 text-center col-md-offset-3">
                    <button class="btn btn-primary" id="turn_on">å¼€ä¸ªç¯å‘—</button>
                    <button class="btn btn-primary" id="play">éŸ³ä¹å“èµ·æ¥ï¼</button>
                    <button class="btn btn-primary" id="bannar_coming">æ¥ç‚¹è£…é¥°</button>
                    <button class="btn btn-primary" id="balloons_flying">å†æ¥ç‚¹æ°”çƒï¼Ÿ</button>
                    <button class="btn btn-primary" id="cake_fadein">ä¸Šè›‹ç³•ï¼</button>
                    <button class="btn btn-primary" id="light_candle">ç‚¹èœ¡çƒ›å•¦</button>
                    <button class="btn btn-primary" id="make_wish">è®¸ä¸ªæ„¿å§~~</button>
                    <button class="btn btn-primary" id="blow_candle">è®¸å¥½äº†ï¼Œå¹ç­å®ƒï¼</button>
                    <button class="btn btn-primary" id="wish_message">Happy Birthday!</button>
                    <button class="btn btn-primary" id="story">A Message For You</button>
                </div>
            </div>
        </div>
    </div>
    <canvas id="fireworks-canvas"></canvas>

    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    
    <script>
    $(window).load(function(){ $('.loading').fadeOut('fast'); $('.container').fadeIn('fast'); });
    
    $(document).ready(function(){
        $('#turn_on').click(function(){

            // --- æ ¸å¿ƒä¿®å¤ï¼šé¢„è§£é”éŸ³é¢‘ ---
            const mainAudio = document.getElementById('main_audio');
            const fireworkAudio = document.getElementById('firework_audio');
            
            // æ’­æ”¾å¹¶ç«‹å³æš‚åœï¼Œéª—è¿‡æµè§ˆå™¨çš„å®‰å…¨æœºåˆ¶
            mainAudio.play().then(() => mainAudio.pause());
            fireworkAudio.play().then(() => fireworkAudio.pause());
            
            $('.bulb').addClass('bulb-glow-yellow'); $('body').addClass('peach');
            $(this).fadeOut().delay(1000).promise().done(() => $('#play').fadeIn());
        });

        $('#play').click(function(){
            $('#main_audio')[0].play();
            $('body').addClass('peach-after');
            $(this).fadeOut().delay(1000).promise().done(() => $('#bannar_coming').fadeIn());
        });

        $('#bannar_coming').click(function(){
            $('.bannar').addClass('bannar-come');
            $(this).fadeOut().delay(1000).promise().done(() => $('#balloons_flying').fadeIn());
        });

        $('#balloons_flying').click(function(){
            $('.balloon-border').animate({top:-500}, 8000);
            $('.balloons').each(function(index){
                var startLeft = (index * 13) + 5 + "%"; 
                $(this).css({left: startLeft, top: "85%", display: "block"});
                if(index % 2 == 0) $(this).addClass('balloons-rotate-behaviour-one');
                else $(this).addClass('balloons-rotate-behaviour-two');
                driftBottom('#' + this.id);
            });

            function driftBottom(id) {
                var winH = $(window).height();
                var moveX = parseFloat($(id).css('left')) + (Math.random() * 40 - 20);
                var moveY = (winH * 0.78) + (Math.random() * (winH * 0.12));
                $(id).animate({left: moveX, top: moveY}, 6000, function(){
                    driftBottom(id);
                });
            }
            $(this).fadeOut().delay(1000).promise().done(() => $('#cake_fadein').fadeIn());
        });

        $('#cake_fadein').click(function(){
            $('.cake').fadeIn('slow');
            $(this).fadeOut().delay(1000).promise().done(() => $('#light_candle').fadeIn());
        });

        $('#light_candle').click(function(){
            $('.fuego').fadeIn('slow');
            $(this).fadeOut().promise().done(() => $('#make_wish').fadeIn());
        });

        $('#make_wish').click(function(){
            $(this).fadeOut();
            $('#wish_guide').fadeIn('slow');
            setTimeout(() => { $('#blow_candle').fadeIn('slow'); }, 2500);
        });

        $('#blow_candle').click(function() {
            $('#wish_guide').fadeOut('fast');
            $('.fuego').fadeOut('slow');
            $(this).fadeOut().promise().done(() => $('#wish_message').fadeIn());
        });

        // æ ¸å¿ƒä¿®æ”¹ï¼šç‚¹å‡» Happy Birthday æŒ‰é’®ï¼Œæ–‡å­—å‡ºç°å¹¶é£å‡
        $('#wish_message').click(function(){
            let vw = $(window).width()/2;
            $('.balloons').stop(); 
            
            // --- ä¿®æ”¹ï¼šè®©æ–‡å­—åœ¨é£å‡å¼€å§‹æ—¶æ˜¾ç¤º ---
            $('.balloons h2').css({
				'display': 'block',  // å¼ºåˆ¶æ˜¾ç¤º
				'opacity': '1',      // å¼ºåˆ¶ä¸é€æ˜
				'visibility': 'visible' // å¼ºåˆ¶å¯è§
			}).fadeIn(1000);

            const finalTop = 80; 
            $('#b1').animate({top: finalTop, left: vw-240}, 2500);
            $('#b2').animate({top: finalTop, left: vw-160}, 2500);
            $('#b3').animate({top: finalTop, left: vw-80}, 2500);
            $('#b4').animate({top: finalTop, left: vw+0}, 2500);
            $('#b5').animate({top: finalTop, left: vw+80}, 2500);
            $('#b6').animate({top: finalTop, left: vw+160}, 2500);
            $('#b7').animate({top: finalTop, left: vw+240}, 2500);
            
            $(this).fadeOut().delay(2500).promise().done(() => $('#story').fadeIn());
        });

        // å¿ƒé‡Œè¯ä¸çƒŸèŠ±é€»è¾‘ä¿æŒå›é€€ç‰ˆçš„åŸæ ·
        $('#story').click(function(){
            $(this).fadeOut();
            $('.message').fadeIn('slow');
            const messages = ["ä»Šå¤©æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ—¥å­","2æœˆ18æ—¥","æ½˜å€©é›¯ç”Ÿæ—¥å•¦~","ä¸èƒ½ç»™ä½ å½“é¢è¿‡ç”Ÿæ—¥å‘¢","å°±åªèƒ½ä»¥è¿™æ ·çš„å½¢å¼å•¦ï¼Œ","ç¬¬ä¸€æ¬¡æœ‰äººè¿™æ ·ç»™ä½ è¿‡ç”Ÿæ—¥å§~å“ˆå“ˆå“ˆ~","å¸Œæœ›æˆ‘ä»¬æ¼‚äº®çš„æ½˜å€©é›¯æ¯å¤©éƒ½èƒ½å¼€å¿ƒå¹¸ç¦","å¹³å®‰å–œä¹ï¼Œå–œä¹ï¼Œå–œä¹","ä¸»è¦æ˜¯å–œä¹æ˜‚ï¼Œé‡è¦çš„äº‹æƒ…è¯´ä¸‰é","é©¬å¹´é¡ºé¡ºåˆ©åˆ©å“¦~","ç¥ä½ ç”Ÿæ—¥å¿«ä¹é¸­ï¼ï¼ï¼","ç”Ÿæ—¥å¿«ä¹~ç”Ÿæ—¥å¿«ä¹~ç”Ÿæ—¥å¿«ä¹~","è¿™ä¸¤å¤©çƒŸèŠ±çœ‹äº†å¾ˆå¤šå§","æˆ‘ä¹Ÿå‡†å¤‡äº†ä¸€ä¸ªçƒŸèŠ±,å“ˆå“ˆå“ˆ","ç”µå­çƒŸèŠ±åªä¸ºä½ ç»½æ”¾~"];
            function showMsg(i) {
                $('.message p').hide().text(messages[i]).fadeIn(1000).delay(2500).fadeOut(1000, function(){
                    if(++i < messages.length) showMsg(i);
                    else {
                        $('.container, .balloons, .balloon-border').fadeOut('slow');
                        // åœæ­¢ç¬¬ä¸€é¦–
                        const mAudio = document.getElementById('main_audio');
                        mAudio.pause(); 
                        
                        // æ’­æ”¾çƒŸèŠ±éŸ³ä¹
                        const fAudio = document.getElementById('firework_audio');
                        fAudio.currentTime = 0; // é‡ç½®æ—¶é—´
                            fAudio.play().catch(e => {
                                // å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œåœ¨å±å¹•ç‚¹ä¸€ä¸‹ç«‹åˆ»æ’­æ”¾
                                console.log("è‡ªåŠ¨æ’­æ”¾è¢«æ‹¦æˆªï¼Œç­‰å¾…ç‚¹å‡»è§¦å‘");
                                $(document).one('click', () => fAudio.play());
                            });                 
                        $('#fireworks-canvas').fadeIn(1500); 
                        initFireworks();
                        $('#main_audio')[0].pause(); $('#firework_audio')[0].play();
                        $('#fireworks-canvas').fadeIn(1500); initFireworks();
                    }
                });
            }
            showMsg(0);
        });
    });

    // çƒŸèŠ±å‡½æ•°ä¿æŒä¸å˜...
    function initFireworks() {
    const canvas = document.getElementById('fireworks-canvas');
    const ctx = canvas.getContext('2d');
    
    // è®¾ç½®ç”»å¸ƒå¤§å°å¹¶ç›‘å¬çª—å£ç¼©æ”¾
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    let particles = [];

    class Particle {
        constructor(x, y, color, speed, angle) {
            this.x = x;
            this.y = y;
            this.color = color;
            this.velX = Math.cos(angle) * speed;
            this.velY = Math.sin(angle) * speed;
            this.friction = 0.96; 
            this.gravity = 0.15;  
            this.alpha = 1;       
            this.decay = Math.random() * 0.015 + 0.008; // ç¨å¾®æ”¾æ…¢æ¶ˆå¤±é€Ÿåº¦ï¼Œç»™é—ªçƒç•™ç©ºé—´
            this.size = Math.random() * 2 + 0.5;
            // æ–°å¢ï¼šç»™æ¯ä¸ªç²’å­ä¸€ä¸ªç‹¬ç‰¹çš„é—ªçƒé¢‘ç‡
            this.flickerBase = Math.random() * 10;
        }

        update() {
            this.velX *= this.friction;
            this.velY *= this.friction;
            this.velY += this.gravity;
            this.x += this.velX;
            this.y += this.velY;
            this.alpha -= this.decay;
        }

        draw() {
            if (this.alpha <= 0) return;

            ctx.save();
            // --- æ ¸å¿ƒé—ªçƒé€»è¾‘ ---
            // åˆ©ç”¨éšæœºæ•°è®©ç²’å­åœ¨æ¯ä¸€å¸§éƒ½æœ‰ 30% çš„æ¦‚ç‡å¤§å¹…å˜æš—æˆ–æ¶ˆå¤±
            // è¿™ç§ä¸è§„å¾‹çš„é—ªçƒæ¯”æ­£å¼¦æ³¢é—ªçƒæ›´åƒçœŸå®çš„çƒŸèŠ±ä½™æ™–
            let flickerAlpha = this.alpha;
            if (Math.random() > 0.7) {
                flickerAlpha = this.alpha * 0.3; // ç¬é—´å˜æš—
            }

            ctx.globalAlpha = flickerAlpha;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            
            // å¢åŠ å‘å…‰æ ¸å¿ƒï¼Œé—ªçƒæ—¶ä¼šæœ‰äº®æ™¶æ™¶çš„æ„Ÿè§‰
            ctx.shadowBlur = flickerAlpha * 12;
            ctx.shadowColor = this.color;
            
            ctx.fill();
            ctx.restore();
        }
    }

    // çˆ†ç‚¸é€»è¾‘æ ¸å¿ƒï¼šåœ¨æŒ‡å®šä½ç½®ç”Ÿæˆç²’å­ä¸›
    function createExplosion(x, y) {
        const count = 150; // æ¯æ¬¡ç‚¹å‡»ç‚¸å‡ºçš„ç²’å­æ•°é‡
        const baseHue = Math.random() * 360; // éšæœºä¸€ä¸ªä¸»è‰²è°ƒ
        for (let i = 0; i < count; i++) {
            // è‰²å½©åœ¨ä¸»è‰²è°ƒé™„è¿‘å¾®è°ƒï¼Œæ›´æœ‰å±‚æ¬¡æ„Ÿ
            const color = `hsl(${baseHue + (Math.random() * 40 - 20)}, 100%, 60%)`;
            const speed = Math.random() * 12 + 2; // ç‚¸å¼€çš„é€Ÿåº¦
            const angle = Math.random() * Math.PI * 2;
            particles.push(new Particle(x, y, color, speed, angle));
        }
    }

    // --- äº¤äº’åŠŸèƒ½ï¼šç›‘å¬ç‚¹å‡»å’Œè§¦æ‘¸ ---
    // é¼ æ ‡ç‚¹å‡»
    canvas.addEventListener('mousedown', (e) => {
        createExplosion(e.clientX, e.clientY);
    });

    // æ‰‹æœºè§¦æ‘¸
    canvas.addEventListener('touchstart', (e) => {
        // é˜²æ­¢é¡µé¢æ»‘åŠ¨å¹²æ‰°
        e.preventDefault();
        const touch = e.touches[0];
        createExplosion(touch.clientX, touch.clientY);
    }, { passive: false });

    // åŠ¨ç”»å¾ªç¯
    let autoTimer = 0;
    function animate() {
        // èƒŒæ™¯ç•™å±‚ï¼Œåˆ¶é€ æ‹–å°¾æ®‹å½±ï¼ˆé…·ç‚«çš„å…³é”®ï¼‰
        ctx.fillStyle = 'rgba(0, 0, 0, 0.13)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        for (let i = particles.length - 1; i >= 0; i--) {
            particles[i].update();
            particles[i].draw();
            if (particles[i].alpha <= 0) {
                particles.splice(i, 1);
            }
        }

        // ä¾ç„¶ä¿ç•™è‡ªåŠ¨å‘å°„ï¼Œé˜²æ­¢æ²¡äººç‚¹çš„æ—¶å€™å¤ªå†·æ¸…
        autoTimer++;
        if (autoTimer % 45 === 0) {
            createExplosion(
                Math.random() * canvas.width, 
                Math.random() * canvas.height * 0.4 + 100 // åœ¨å±å¹•ä¸ŠåŠéƒ¨åˆ†è‡ªåŠ¨ç‚¸
            );
        }

        requestAnimationFrame(animate);
    }
    animate();
	}
    </script>
</body>
</html>
